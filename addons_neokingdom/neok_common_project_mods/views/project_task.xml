<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="neok_proj_view_task_form2_mod" model="ir.ui.view">
        <field name="name">neok_proj_view_task_form2_mod</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="priority">3</field>
        <field name="arch" type="xml">

            <xpath expr="//page[@name='sub_tasks_page']" position="replace">
                <page name="sub_tasks_page" string="Sub-tasks" attrs="{'invisible': [('allow_subtasks', '=', False)]}">
                    <field name="child_ids"
                           context="{'search_view_ref' : 'project.view_task_search_form_extended', 'default_project_id': project_id if not parent_id or not display_project_id else display_project_id, 'default_user_ids': user_ids, 'default_parent_id': id,                                     'default_partner_id': partner_id, 'default_milestone_id': allow_milestones and milestone_id, 'search_default_display_project_id': project_id }"
                           domain="['!', ('id', 'parent_of', id)]">
                        <tree decoration-muted="is_closed == True">
                            <field name="legend_normal" invisible="1"/>
                            <field name="legend_done" invisible="1"/>
                            <field name="legend_blocked" invisible="1"/>
                            <field name="project_id" invisible="1"/>
                            <field name="is_closed" invisible="1"/>
                            <field name="allow_milestones" invisible="1"/>
                            <field name="sequence" widget="handle"/>
                            <field name="priority" widget="priority" optional="hide" nolabel="1"/>
                            <field name="id" optional="hide"/>
                            <field name="child_text" invisible="1"/>
                            <field name="allow_subtasks" invisible="1"/>
                            <field name="name" widget="name_with_subtask_count"/>
                            <field name="user_ids" widget="many2many_tags"/>
                            <field name="planned_hours" string="Allocated Hours"/>
                            <field name="effective_hours"/>
                            <field name="display_project_id" string="Project" optional="hide" options="{'no_open': 1}"/>
                            <field name="milestone_id" optional="hide"
                                   context="{'default_project_id': display_project_id or project_id}"
                                   attrs="{'invisible': [('allow_milestones', '=', False)], 'column_invisible': [('parent.allow_milestones', '=', False)]}"/>
                            <field name="partner_id" optional="hide"/>
                            <field name="user_ids" widget="many2many_avatar_user" optional="show"
                                   domain="[('share', '=', False), ('active', '=', True)]"/>
                            <field name="company_id" groups="base.group_multi_company" optional="hide"/>
                            <field name="company_id" invisible="1"/>
                            <field name="activity_ids" string="Next Activity" widget="list_activity" optional="hide"/>
                            <field name="date_deadline" attrs="{'invisible': [('is_closed', '=', True)]}"
                                   optional="hide"/>
                            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"
                                   optional="hide"/>
                            <field name="rating_last_text" string="Rating" decoration-danger="rating_last_text == 'ko'"
                                   decoration-warning="rating_last_text == 'ok'"
                                   decoration-success="rating_last_text == 'top'"
                                   attrs="{'invisible': [('rating_last_text', '=', 'none')]}" class="fw-bold"
                                   widget="badge" optional="hide"/>
                            <field name="kanban_state" widget="state_selection" optional="hide"
                                   options="{'hide_label': True}" nolabel="1"/>
                            <field name="stage_id" optional="show" context="{'default_project_id': project_id}"/>
                        </tree>
                    </field>
                </page>
            </xpath>

        </field>
    </record>

</odoo>
